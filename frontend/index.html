<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ResumeAI Pro - AI-Powered Resume Screening</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a0f;
      --surface: #12121a;
      --surface-hover: #1a1a24;
      --border: #2a2a3a;
      --text: #ffffff;
      --text-muted: #8a8a9a;
      --primary: #6366f1;
      --primary-hover: #818cf8;
      --success: #22c55e;
      --warning: #eab308;
      --danger: #ef4444;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* Header */
    .header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo h1 {
      font-size: 20px;
      font-weight: 700;
    }

    .logo span {
      color: var(--primary);
    }

    /* Cards */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .step-num {
      width: 28px;
      height: 28px;
      background: var(--primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
    }

    .card-title h2 {
      font-size: 16px;
      font-weight: 600;
    }

    .counter {
      background: var(--border);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    /* Textarea */
    .textarea {
      width: 100%;
      min-height: 120px;
      padding: 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
    }

    .textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .textarea::placeholder {
      color: var(--text-muted);
    }

    /* Upload Zone */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-zone:hover {
      border-color: var(--primary);
      background: rgba(99, 102, 241, 0.05);
    }

    .upload-zone.active {
      border-color: var(--primary);
      background: rgba(99, 102, 241, 0.1);
    }

    .upload-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .upload-zone h3 {
      font-size: 15px;
      margin-bottom: 4px;
    }

    .upload-zone p {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* File List */
    .file-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 8px;
    }

    .file-icon {
      font-size: 20px;
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-size: 14px;
      font-weight: 500;
    }

    .file-remove {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px;
      font-size: 18px;
    }

    .file-remove:hover {
      color: var(--danger);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 28px;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--primary-hover);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--border);
      color: var(--text);
      padding: 10px 16px;
      font-size: 13px;
    }

    /* Action */
    .action {
      text-align: center;
      padding: 20px 0 40px;
    }

    .action-hint {
      margin-top: 12px;
      color: var(--text-muted);
      font-size: 14px;
    }

    /* Results */
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .results-header h2 {
      font-size: 22px;
      font-weight: 700;
    }

    .result-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .result-card.top {
      border-color: var(--warning);
      background: rgba(234, 179, 8, 0.05);
    }

    .result-inner {
      display: flex;
    }

    .result-rank {
      width: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      border-right: 1px solid var(--border);
      padding: 20px 0;
    }

    .result-card.top .result-rank {
      background: rgba(234, 179, 8, 0.1);
    }

    .rank-num {
      font-size: 22px;
      font-weight: 800;
      color: var(--text-muted);
    }

    .result-card.top .rank-num {
      color: var(--warning);
    }

    .result-body {
      flex: 1;
      padding: 20px;
    }

    .result-top {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .result-name {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .result-title {
      font-size: 13px;
      color: var(--text-muted);
    }

    .result-score {
      text-align: right;
    }

    .score-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--primary);
    }

    .score-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .result-summary {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.6;
      margin-bottom: 14px;
    }

    .result-recommendation {
      font-size: 13px;
      padding: 10px 14px;
      background: var(--bg);
      border-radius: 8px;
      margin-bottom: 14px;
    }

    .result-recommendation strong {
      color: var(--primary);
    }

    /* Fit Badge */
    .fit-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      margin-left: 10px;
    }

    .fit-high {
      background: rgba(34, 197, 94, 0.2);
      color: var(--success);
    }

    .fit-medium {
      background: rgba(234, 179, 8, 0.2);
      color: var(--warning);
    }

    .fit-low {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    /* Skills */
    .skills-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .skill {
      padding: 4px 10px;
      background: rgba(99, 102, 241, 0.15);
      color: var(--primary);
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .skill.missing {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 60px 0;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 40px 0;
      color: var(--text-muted);
      font-size: 13px;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 48px 0 40px;
    }

    .hero h2 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .hero p {
      color: var(--text-muted);
      font-size: 16px;
    }

    .hero .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(99, 102, 241, 0.15);
      color: var(--primary);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 16px;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef } = React;
    const API = "http://localhost:8000";
    
    function App() {
      const [jd, setJd] = useState('');
      const [files, setFiles] = useState([]);
      const [loading, setLoading] = useState(false);
      const [results, setResults] = useState(null);
      const [dragActive, setDragActive] = useState(false);
      const inputRef = useRef(null);

      const uploadFile = async (fileList) => {
        const arr = Array.from(fileList);
        if (!arr.length) return;

        const form = new FormData();
        arr.forEach(f => form.append("files", f));

        try {
          const res = await fetch(`${API}/upload-resumes`, { method: "POST", body: form });
          const data = await res.json();
          if (data.uploaded?.length) {
            setFiles(prev => [...prev, ...data.uploaded]);
          }
          if (data.errors?.length) alert(data.errors.join("\n"));
        } catch (e) {
          alert("Upload failed: " + e.message);
        }
      };

      const removeFile = async (id) => {
        await fetch(`${API}/resumes/${id}`, { method: "DELETE" });
        setFiles(prev => prev.filter(f => f.id !== id));
      };

      const analyze = async () => {
        if (!jd || files.length === 0) return;
        
        setLoading(true);
        setResults(null);
        
        try {
          // Upload JD
          await fetch(`${API}/upload-jd`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: jd })
          });
          
          // Analyze
          await fetch(`${API}/analyze`, { method: "POST" });
          
          // Get results
          const res = await fetch(`${API}/results`);
          const data = await res.json();
          setResults(data.results);
          
          setTimeout(() => {
            document.getElementById("results")?.scrollIntoView({ behavior: "smooth" });
          }, 100);
        } catch (e) {
          alert("Error: " + e.message);
        } finally {
          setLoading(false);
        }
      };

      const reset = async () => {
        await fetch(`${API}/reset`, { method: "POST" });
        setFiles([]);
        setResults(null);
        setJd('');
      };

      return (
        <>
          <header className="header">
            <div className="container">
              <div className="header-inner">
                <div className="logo">
                  <div className="logo-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2">
                      <circle cx="12" cy="8" r="4"/>
                      <path d="M6 20c0-4 3-6 6-6s6 2 6 6"/>
                    </svg>
                  </div>
                  <h1>Resume<span>AI</span> Pro</h1>
                </div>
                {files.length > 0 && (
                  <button className="btn btn-secondary" onClick={reset}>Reset</button>
                )}
              </div>
            </div>
          </header>

          <main className="container">
            <section className="hero">
              <div className="badge">‚ú® Powered by OpenAI GPT-4</div>
              <h2>AI-Powered Resume Screening</h2>
              <p>Upload resumes and get intelligent, personalized candidate analysis in seconds.</p>
            </section>

            {/* Step 1: JD */}
            <div className="card">
              <div className="card-header">
                <div className="card-title">
                  <div className="step-num">1</div>
                  <h2>Job Description</h2>
                </div>
                {jd.length > 50 && <span style={{color: 'var(--success)'}}>‚úì</span>}
              </div>
              <textarea
                className="textarea"
                placeholder="Paste the job description here...&#10;&#10;Example: We're looking for a Full-Stack Developer with 3+ years experience in React, Node.js, Python, AWS..."
                value={jd}
                onChange={(e) => setJd(e.target.value)}
              />
            </div>

            {/* Step 2: Resumes */}
            <div className="card">
              <div className="card-header">
                <div className="card-title">
                  <div className="step-num">2</div>
                  <h2>Upload Resumes</h2>
                </div>
                <div className="counter">{files.length} uploaded</div>
              </div>

              {files.map(f => (
                <div key={f.id} className="file-item">
                  <span className="file-icon">üìÑ</span>
                  <div className="file-info">
                    <div className="file-name">{f.name}</div>
                  </div>
                  <button className="file-remove" onClick={() => removeFile(f.id)}>√ó</button>
                </div>
              ))}

              <div
                className={`upload-zone ${dragActive ? 'active' : ''}`}
                onDragOver={(e) => { e.preventDefault(); setDragActive(true); }}
                onDragLeave={() => setDragActive(false)}
                onDrop={(e) => { e.preventDefault(); setDragActive(false); uploadFile(e.dataTransfer.files); }}
                onClick={() => inputRef.current?.click()}
              >
                <div className="upload-icon">üìÅ</div>
                <h3>Drop files here or click to browse</h3>
                <p>PDF, DOCX, or TXT files</p>
                <input
                  ref={inputRef}
                  type="file"
                  multiple
                  accept=".pdf,.docx,.txt"
                  style={{ display: 'none' }}
                  onChange={(e) => { uploadFile(e.target.files); e.target.value = ''; }}
                />
              </div>
            </div>

            {/* Analyze Button */}
            <div className="action">
              <button
                className="btn btn-primary"
                onClick={analyze}
                disabled={!jd || files.length === 0 || loading}
              >
                {loading ? (
                  <>
                    <div className="spinner" style={{width: 18, height: 18, borderWidth: 2}}></div>
                    Analyzing with AI...
                  </>
                ) : (
                  <>ü§ñ Analyze with AI</>
                )}
              </button>
              {!loading && files.length === 0 && (
                <p className="action-hint">Upload at least 1 resume to continue</p>
              )}
            </div>

            {/* Results */}
            {results && (
              <section id="results" style={{ paddingBottom: 40 }}>
                <div className="results-header">
                  <h2>Analysis Results</h2>
                  <span style={{ color: 'var(--text-muted)', fontSize: 14 }}>
                    {results.length} candidates ranked by AI
                  </span>
                </div>

                {results.map((r, i) => (
                  <div key={r.file_name} className={`result-card ${i === 0 ? 'top' : ''}`}>
                    <div className="result-inner">
                      <div className="result-rank">
                        {i === 0 ? 'üèÜ' : <span className="rank-num">#{r.rank}</span>}
                      </div>
                      <div className="result-body">
                        <div className="result-top">
                          <div>
                            <div className="result-name">
                              {r.candidate_name}
                              <span className={`fit-badge fit-${r.fit_level?.toLowerCase()}`}>
                                {r.fit_level}
                              </span>
                            </div>
                            <div className="result-title">{r.current_title}</div>
                          </div>
                          <div className="result-score">
                            <div className="score-value">{r.match_score}%</div>
                            <div className="score-label">Match</div>
                          </div>
                        </div>
                        
                        <div className="result-summary">{r.summary}</div>
                        
                        <div className="result-recommendation">
                          <strong>Recommendation:</strong> {r.recommendation}
                        </div>
                        
                        <div className="skills-row">
                          {r.matched_skills?.slice(0, 6).map(s => (
                            <span key={s} className="skill">{s}</span>
                          ))}
                          {r.missing_skills?.slice(0, 3).map(s => (
                            <span key={s} className="skill missing">-{s}</span>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </section>
            )}
          </main>

          <footer className="footer">
            <p>ResumeAI Pro ‚Ä¢ Powered by OpenAI GPT-4o-mini</p>
          </footer>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>

</html>